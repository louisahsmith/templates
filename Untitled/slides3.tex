% !TeX program = XeLaTeX

% run this before compiling if glossary not showing up/complete:
% makeindex -s probstat_slides.ist -o probstat_slides.gls probstat_slides.glo

\documentclass[$if(handout)$handout,$endif$ 13.5pt]{beamer}

\input{config/presento.sty}

\usepackage{textpos}
\setlength{\TPHorizModule}{1cm}
\setlength{\TPVertModule}{1cm}

\newcommand\crule[1][black]{\textcolor{#1}{\rule{2cm}{2cm}}}
\def\tightlist{}
\usepackage{float}
\usepackage{graphicx}
\usepackage{wrapfig}
\usepackage{underscore}
\usepackage{multirow}
\usepackage{booktabs}
\usepackage{longtable}
\usepackage{nicefrac}
\usepackage{bm}
\usepackage{pgf,tikz}
\usetikzlibrary{positioning}
\usetikzlibrary{shapes}
\usetikzlibrary{arrows.meta}
\usepackage{tkz-tab}
\usepackage[labelformat=simple]{subcaption}
\renewcommand\thesubfigure{(\alph{subfigure})}

\newif\ifbibliography
% \usepackage{natbib}
% \bibliographystyle{$if(biblio-style)$$biblio-style$$else$plainnat$endif$}
\usepackage[$if(biblio-style)$bibstyle=$biblio-style$$else$bibstyle=nejm$endif$,$if(cite-style)$citestyle=$cite-style$$else$citestyle=ext-authoryear$endif$,$for(biblatexoptions)$$biblatexoptions$$sep$$endfor$,backend=bibtex, maxbibnames = 3, maxcitenames = 1, mincitenames = 1, url = false, doi = false, isbn = false]{biblatex}
$for(bibliography)$
\addbibresource{$bibliography$}
$endfor$
\renewcommand*{\nameyeardelim}{\addcomma\space}

\usepackage{hyperref}

\DeclareOuterCiteDelim{cite}{\color{colordgray}{\bibopenbracket}}{\color{colordgray}{\bibclosebracket}}
\DeclareOuterCiteDelim{textcite}{\color{colordgray}{\bibopenbracket}}{\color{colordgray}{\bibclosebracket}}
\DeclareOuterCiteDelim{parencite}{\color{colordgray}{\bibopenbracket}}{\color{colordgray}{\bibclosebracket}}

\DeclareFieldFormat{citehyperref}{%
  \DeclareFieldAlias{bibhyperref}{noformat}% Avoid nested links
  \bibhyperref{#1}}

\DeclareFieldFormat{textcitehyperref}{%
  \DeclareFieldAlias{bibhyperref}{noformat}% Avoid nested links
  \bibhyperref{%
    #1%
    \ifbool{cbx:parens}
      {\bibcloseparen\global\boolfalse{cbx:parens}}
      {}}}

\savebibmacro{cite}
\savebibmacro{textcite}
\savebibmacro{autocite}

\renewbibmacro*{cite}{%
  \printtext[citehyperref]{%
    \restorebibmacro{cite}%
    \usebibmacro{cite}}}

\renewbibmacro*{textcite}{%
  \ifboolexpr{
    ( not test {\iffieldundef{prenote}} and
      test {\ifnumequal{\value{citecount}}{1}} )
    or
    ( not test {\iffieldundef{postnote}} and
      test {\ifnumequal{\value{citecount}}{\value{citetotal}}} )
  }
    {\DeclareFieldAlias{textcitehyperref}{noformat}}
    {}%
  \printtext[textcitehyperref]{%
    \restorebibmacro{textcite}%
    \usebibmacro{textcite}}}

\renewbibmacro*{autocite}{%
  \printtext[citehyperref]{%
    \restorebibmacro{autocite}%
    \usebibmacro{autocite}}}

\hypersetup{colorlinks,linkcolor=,urlcolor=colororange, citecolor = colordgray}

\usefonttheme[onlymath]{serif}
\setbeamercolor{section in toc}{fg=colorgreen}
\setbeamercolor{subsection in toc}{fg=colordgray}
\setbeamercolor{subsection in toc}{fg=colordgray}
\setbeamercolor{normal text}{fg=colorhgray}
\setbeamercolor{caption text}{fg=colordgray}
\setbeamercolor{caption name}{fg=colororange}

\setbeamercolor{bibliography entry author}{fg=colorgreen}
\setbeamercolor{bibliography entry title}{fg=colorhgray}
\setbeamercolor{bibliography entry note}{fg=colorhgray}
\setbeamercolor{bibliography entry journal}{fg=colorhgray}
\setbeamercolor{bibliography entry booktitle}{fg=colorhgray}
\setbeamercolor{bibliography entry location}{fg=colorhgray}
\setbeamertemplate{bibliography item}[triangle]
\setbeamercolor{bibliography item}{fg=colororange}

%\captionsetup{textfont=colordgray,labelfont=colororange}
\setbeamertemplate{frametitle continuation}{}

\newcommand{\E}{{\operatorname E}}
\newcommand{\Var}{{\operatorname {Var}}}
\newcommand{\Cov}{{\operatorname {Cov}}}


\newcommand{\myTitle}{\color{colorblue}\hugetext{$if(title)$$title$$endif$}}
\newcommand{\mySubtitle}{\color{colorblue}\montserratfont\largetext{$if(subtitle)$$subtitle$$endif$}}
\newcommand{\myName}{\largetext{\color{colororange}{$if(name)$$name$$endif$}}}
\newcommand{\myInstitution}{\setnote{\textcolor{colororange}{$if(institution)$$institution$$endif$}}}
\newcommand{\myDate}{\setnote{\textcolor{colorgreen}{$if(date)$$date$$endif$}}}

\begin{document}
$if(title)$
\begin{frame}[plain]
  \vfill
    \myTitle
    \mySubtitle
    \vfill
    \myName
    \myInstitution
     \vfill
    \myDate
    \vfill
\addtocounter{framenumber}{-1}
\addtocounter{page}{-1}
\end{frame}
$endif$

$for(include-before)$
$include-before$
$endfor$

$if(toc)$
\begin{frame}
\tableofcontents[hideallsubsections]
\end{frame}
$endif$

$body$

% $if(bibliography)$
% $if(biblio-title)$
% $if(book-class)$
% \renewcommand\bibname{$biblio-title$}
% $else$
% \renewcommand\refname{$biblio-title$}
% $endif$
% $endif$
% \begin{frame}[allowframebreaks]{$biblio-title$}
% \bibliographytrue
% \bibliography{$for(bibliography)$$bibliography$$sep$,$endfor$}
% \end{frame}
% $endif$


\begin{frame}[allowframebreaks]{$if(biblio-title)$$biblio-title$$else$References$endif$}
\bibliographytrue
\printbibliography[heading=none]
$for(bibpages)$
\addtocounter{framenumber}{-$bibpages$}
\addtocounter{page}{-$bibpages$}
$sep$
$endfor$
\end{frame}


% $if(references)$
% \begin{frame}[plain, allowframebreaks]{References}
% \bibliographystyle{/config/epi-custom}
% \bibliography{/config/library}
% % \bibliography{$for(bibliography)$$bibliography$$sep$,$endfor$}
% $for(bibpages)$
% \addtocounter{framenumber}{-$bibpages$}
% \addtocounter{page}{-$bibpages$}
% $sep$
% $endfor$
% \end{frame}
% $endif$

$for(include-after)$
$include-after$
$endfor$

\end{document}
